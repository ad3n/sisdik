{% extends 'FastSisdikBundle::layout.html.twig' %}

{% block page_heading %}{% trans from "headings" %}payment.registrationfee.mortgage{% endtrans %}{% endblock %}
{% block content %}
<style type="text/css">
.controls {
    margin-left: 0;
}
</style>

<div class="row-fluid">
    <div class="span12">
        <dl>
            <dt>{{ 'label.yearentry.entry'|trans }}</dt>
            <dd>{% if siswa.tahunmasuk is not null %}{{ siswa.tahunmasuk.tahun }}{% endif %}</dd>
            <dt>{{ 'label.admissiongroup.entry'|trans }}</dt>
            <dd>{% if siswa.gelombang is not null %}{{ siswa.gelombang.nama }}{% endif %}</dd>
            <dt>{{ 'label.name.full'|trans }}</dt>
            <dd>{{ siswa.namaLengkap }}</dd>
            <dt>{{ 'label.application.number'|trans }}</dt>
            <dd>{{ siswa.nomorPendaftaran }}</dd>
            <dt>{{ 'label.gender'|trans }}</dt>
            <dd>{% if siswa.jenisKelamin == 'L' %}{{ 'male'|trans }}{% elseif siswa.jenisKelamin %}{{ 'female'|trans }}{% endif %}</dd>
    		{% if siswa.orangtuaWali %}
    		    {% for orangtua in siswa.orangtuaWali %}
    		        {% if orangtua %}
    		            {% if orangtua.aktif == 1 %}
            	            <dt>{{ 'label.name.parent.or.guardian'|trans }}</dt>
            	            <dd>{{ orangtua.nama }}</dd>
            	            <dt>{{ 'label.mobilephone.parent'|trans }}</dt>
            	            <dd>{{ orangtua.ponsel }}</dd>
        		        {% endif %}
    		        {% endif %}
    		    {% endfor %}
    		{% endif %}
        	</dd>
        </dl>

        <div class="clearfix" style="margin-bottom: 2em;"></div>

        <h4>{{ 'payment.registrationfee.entry'|trans({}, 'headings') }}</h4>
        <form id="pay-form" action="{{ path('payment_registrationfee_update', { 'sid': siswa.id, 'id': entity.id, 'page': app.request.get('page') }) }}" method="post" {{ form_enctype(edit_form) }} class="form-horizontal">
            {{ form_widget(edit_form.daftarBiayaPendaftaran) }}
            <div id="payment-info" style="margin-bottom: 18px; margin-top: 0.5em;">
                {{ 'shortinfo.total.payables'|trans }} <b>{{ currencySymbol(locale) }}. <span id="payable-amount">{{ nominalBiaya|number_format(0, ',', '.') }}</span></b><br />
                {{ 'shortinfo.total.paid'|trans }} <b>{{ currencySymbol(locale) }}. {{ totalNominalTransaksiSebelumnya|number_format(0, ',', '.') }}</b>
            </div>
            {% for transaksi in edit_form.transaksiPembayaranPendaftaran %}
                {% if loop.length > 1 %}
                    {% if not loop.last %}
                        <div class="control-group">
                            {{ form_label(transaksi.nominalPembayaran) }}&nbsp;#{{ loop.index }}&nbsp;
                            {{ form_widget(transaksi.nominalPembayaran, { 'attr': {'disabled': 'disabled'} }) }}
                            {{ form_errors(transaksi.nominalPembayaran) }}
                        </div>
                        <div class="control-group">
                            {{ form_label(transaksi.keterangan) }}&nbsp;#{{ loop.index }}&nbsp;
                            {{ form_widget(transaksi.keterangan, { 'attr': {'disabled': 'disabled'} }) }}
                            {{ form_errors(transaksi.keterangan) }}
                        </div>
                    {% else %}
                        <div class="control-group">
                            {{ form_label(transaksi.nominalPembayaran) }}&nbsp;#{{ loop.index }}&nbsp;
                            {{ form_widget(transaksi.nominalPembayaran) }}
                            {{ form_errors(transaksi.nominalPembayaran) }}
                        </div>
                        <div class="control-group">
                            {{ form_label(transaksi.keterangan) }}&nbsp;#{{ loop.index }}&nbsp;
                            {{ form_widget(transaksi.keterangan) }}
                            {{ form_errors(transaksi.keterangan) }}
                        </div>
                    {% endif %}
                {% else %}
                    <div class="control-group">
                        {{ form_label(transaksi.nominalPembayaran) }}&nbsp;
                        {{ form_widget(transaksi.nominalPembayaran) }}
                        {{ form_errors(transaksi.nominalPembayaran) }}
                    </div>
                    <div class="control-group">
                        {{ form_label(transaksi.keterangan) }}&nbsp;
                        {{ form_widget(transaksi.keterangan) }}
                        {{ form_errors(transaksi.keterangan) }}
                    </div>
                {% endif %}
            {% endfor %}
            {{ form_rest(edit_form) }}
        	<div class="form-actions">
        	    <button type="submit" class="btn primary">{{ 'label.save'|trans }}</button>
            </div>
        </form>
    </div>
</div>

<div class="clearfix"></div>

<ul class="pills">
    <li>
        <a href="{{ path('payment_registrationfee', { 'sid': siswa.id }) }}">{{ 'link.backtolist'|trans }}</a>
    </li>
</ul>

<div class="clearfix"></div>
<script language="javascript" type="text/javascript">
var total = 0;
var paidamount = {{ totalNominalTransaksiSebelumnya }};

$(document).ready(function() {
	$("#pay-form").submit(function() {
        var payamount = 0;
        var feeamount = parseInt($("#payable-amount").text().split('.').join(''));

        total = 0;

		$(".pay-amount").each(function() {
			var num = 0;

			str = $(this).val().split('.').join('');
		    num = str.match(/\d+/);
		    total += parseInt(num);
		});

	    payamount = parseInt(total);

        if (payamount > feeamount) {
            alert("{{ 'shortinfo.pay.notbiggerthan.fee'|trans }}");
            return false;
        } else if (payamount == paidamount) {
        	alert("{{ 'shortinfo.pay.nozero'|trans }}");
        	return false;
        }

        return true;
    });
});
</script>

{% endblock content %}
